# Railway Backend Fix - DATABASE_URL Missing

## Problem

Backend deployment failing with:
```
Error: Environment variable not found: DATABASE_URL
```

## Root Cause

The PostgreSQL database plugin is either:
1. Not connected to the backend service, OR
2. Not generating the DATABASE_URL variable

## Solution - Add PostgreSQL Plugin

### Step 1: Check if PostgreSQL Plugin Exists

1. In Railway Dashboard, go to your **Project** (zooming-growth)
2. Look for a PostgreSQL service in the service list
3. If you see it: Continue to Step 2
4. If you don't see it: Continue to "Add New PostgreSQL"

### Step 2A: Connect Existing PostgreSQL to Backend

If PostgreSQL already exists:

1. Click on the **PostgreSQL service**
2. Go to **Connect** tab
3. Click **"Link to Service"**
4. Select your **backend service** (serene-adaptation)
5. This will automatically add `DATABASE_URL` to backend variables

### Step 2B: Add New PostgreSQL Database

If PostgreSQL doesn't exist:

1. In your project, click **"+ New"**
2. Select **"Database"**
3. Choose **"Add PostgreSQL"**
4. Railway will create a new PostgreSQL instance
5. Once created, go to the PostgreSQL service
6. Click **"Connect"** ‚Üí **"Link to Service"**
7. Select your **backend service**

### Step 3: Add Other Required Variables

After PostgreSQL is connected, go to **Backend Service** ‚Üí **Variables** tab:

**Add these variables:**

1. **JWT_SECRET** (REQUIRED)
   ```
   JWT_SECRET=kiaan_wms_super_secure_jwt_secret_key_2024_minimum_32_chars_required_for_production
   ```

2. **NODE_ENV** (Recommended)
   ```
   NODE_ENV=production
   ```

3. **DATABASE_URL** - Should now be auto-populated by PostgreSQL plugin
   - Should look like: `postgresql://postgres:***@***:5432/railway`
   - DO NOT manually set this - it's auto-generated

### Step 4: Redeploy Backend

1. Go to **Deployments** tab
2. Click **"Deploy"** ‚Üí **"Redeploy Latest"**
3. Watch the logs for success

## Expected Success Logs

After fixing DATABASE_URL and adding JWT_SECRET:

```
‚úì Running preDeployCommand...
‚úì npx prisma db push --accept-data-loss
‚úì node prisma/seed.js
‚úì üå± Seeding database...
‚úì ‚úÖ Created admin user
‚úì ‚úÖ Created 10 brands
‚úì ‚úÖ Created 16 bundles
‚úì ‚úÖ Created 48 inventory items
‚úì üöÄ WMS API Server running
```

## Alternative: Manual DATABASE_URL (Not Recommended)

If you can't use the PostgreSQL plugin, you can manually set DATABASE_URL.

**However, you need an external PostgreSQL database:**

```
DATABASE_URL=postgresql://username:password@host:port/database
```

‚ö†Ô∏è **Not recommended** - Railway's PostgreSQL plugin is much easier!

## Summary of Required Variables

After completing these steps, your backend should have:

1. ‚úÖ `DATABASE_URL` - Auto-generated from PostgreSQL plugin
2. ‚úÖ `JWT_SECRET` - Manually added
3. ‚úÖ `NODE_ENV=production` - Manually added
4. ‚ö†Ô∏è `PORT` - Auto-generated by Railway (don't set manually)

## Verification

Once deployed successfully:

1. Visit: https://serene-adaptation-production-11be.up.railway.app/health
2. Should return: `{"status":"ok","message":"WMS API is running"}`

3. Test login:
```bash
curl -X POST https://serene-adaptation-production-11be.up.railway.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@kiaan.com","password":"admin123"}'
```

Should return a token (not an error).
